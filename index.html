<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmhouse Bogor - Official Sync v22.8</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #27ae60; --bg: #f8f9fa; --card: #ffffff; --text: #333; --border: #ddd; --zebra: #f2f2f2; }
        body.dark-mode { --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --border: #333; --zebra: #252525; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 20px; background: var(--bg); color: var(--text); transition: 0.3s; }
        .container { max-width: 1600px; margin: auto; }
        .header-app { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 15px 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .sync-info { font-size: 0.85em; margin-top: 5px; color: white; background: #2c3e50; padding: 5px 12px; border-radius: 20px; display: inline-block; font-weight: bold; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-card { padding: 20px; border-radius: 12px; color: white; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stat-card .label { font-size: 0.75em; text-transform: uppercase; opacity: 0.9; margin-bottom: 5px; display: block; }
        .stat-card .value { font-size: 1.4em; }

        .input-section { background: var(--card); padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 10px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; border-top: 6px solid var(--primary); }
        .filter-container { background: var(--card); padding: 15px 20px; border-radius: 12px 12px 0 0; display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end; border-bottom: 1px solid var(--border); }
        .input-group label { font-size: 0.7em; font-weight: bold; margin-bottom: 5px; color: var(--primary); text-transform: uppercase; display: block; }
        input, select { padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: transparent; color: var(--text); outline: none; width: 100%; box-sizing: border-box; }
        body.dark-mode select option { background: #1e1e1e; color: #e0e0e0; }
        .table-container { overflow-x: auto; background: var(--card); border-radius: 0 0 12px 12px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; font-size: 0.85em; }
        th, td { border: 1px solid var(--border); padding: 8px 5px; text-align: center; }
        th { background: #f2f2f2; color: #333; font-weight: bold; font-size: 0.7em; text-transform: uppercase; }
        tbody tr:nth-child(even) { background-color: var(--zebra); }
        .td-edit input, .td-edit select { border: none; background: transparent; text-align: center; color: inherit; font-size: 1.05em; width: 100%; }
        .td-edit input:focus { background: #ffffff !important; color: #000 !important; outline: 2px solid var(--primary); border-radius: 4px; }
        .bg-earning { background: #27ae60 !important; color: white !important; }
        .txt-transfer { color: #e67e22 !important; font-weight: 900; } 
        .txt-tomy { color: #3498db !important; font-weight: 900; }
        .status-dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .dot-green { background-color: #2ecc71; box-shadow: 0 0 8px #2ecc71; }
        .dot-red { background-color: #e74c3c; box-shadow: 0 0 8px #e74c3c; }
        .modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); }
        .modal-content { background: var(--card); margin: 1% auto; padding: 25px; border-radius: 15px; width: 98%; max-width: 1550px; color: var(--text); max-height: 96vh; overflow-y: auto; }
        #loginOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:flex; justify-content:center; align-items:center; z-index:9999; }
        button { cursor: pointer; border-radius: 8px; font-weight: bold; border: none; padding: 10px 15px; }
        .vcard-scroll { display: flex; overflow-x: auto; padding-bottom: 10px; gap: 12px; }
        .vcard-user { background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 12px; border-radius: 12px; min-width: 160px; border-left: 5px solid #e74c3c; flex-shrink: 0; }
        .vcard-user .amt { color: #ffff00; font-weight: 800; font-size: 1.1em; }

        .cal-grid { display: grid; grid-template-columns: repeat(31, 1fr); gap: 2px; margin-top: 5px; width: 100%; }
        .cal-day { font-size: 9px; padding: 4px 0; border-radius: 3px; color: white; text-align: center; font-weight: bold; }
        .day-active { background: #27ae60; }
        .day-missing { background: #e74c3c; opacity: 0.3; }

        /* Style Baru untuk Kalender Target */
        .cal-target-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; background: var(--border); padding: 10px; border-radius: 8px; }
        .cal-target-day { background: var(--card); min-height: 90px; padding: 10px; border-radius: 5px; border: 1px solid var(--border); display: flex; flex-direction: column; justify-content: space-between; }
        .cal-target-date { font-weight: bold; font-size: 1.1em; color: var(--text); }
        .total-info { font-size: 0.85em; margin-top: 5px; }
        .status-lunas { color: #27ae60; font-weight: bold; font-size: 0.8em; margin-top: 4px; }
        .status-minus { color: #e74c3c; font-weight: bold; font-size: 0.8em; margin-top: 4px; }
        .day-header { text-align: center; font-weight: bold; padding: 10px; color: var(--primary); font-size: 0.9em; background: var(--card); border-radius: 5px; }
    </style>
</head>
<body class="dark-mode">

<div id="loginOverlay">
    <div style="background: white; padding: 40px; border-radius: 20px; text-align: center; width: 320px;">
        <h2 style="color:#333; margin:0 0 20px 0;">üîê FARMHOUSE LOGIN</h2>
        <input type="password" id="pinInput" style="text-align:center; font-size:2em; border: 2px solid #ddd;">
        <button style="background:#27ae60; color:white; width:100%; padding:15px; margin-top:20px" onclick="checkPin()">MASUK</button>
    </div>
</div>

<div class="container">
    <div class="header-app">
        <div>
            <h2 style="margin:0; color:var(--primary)">Farmhouse Bogor Official</h2>
            <div id="syncStatus" class="sync-info">üìç Menghubungkan...</div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap: wrap; justify-content: flex-end;">
            <button style="background:#2ecc71; color:white" onclick="openTargetReport()">üéØ Target Setoran</button>
            <button style="background:#16a085; color:white" onclick="openNotesWithPassword()">üìù Notes</button>
            <button style="background:#1abc9c; color:white" onclick="openPersonalStats()">üìä Monthly Report</button>
            <button style="background:#d35400; color:white" onclick="openCashModal()">üíé Top Up Cash</button>
            <button style="background:#e67e22; color:white" onclick="document.getElementById('modalCost').style.display='block'">üí∏ Cost</button>
            <button style="background:#e74c3c; color:white" onclick="bukaKasbonPrompt()">üí∞ Kasbon</button>
            <button style="background:#9b59b6; color:white" onclick="openAccountWithPassword()">üîë Akun Game</button>
            <button style="background:#2c3e50; color:white" onclick="toggleDarkMode()">üåô Mode</button>
            <button style="background:#3498db; color:white" onclick="exportData()">üíæ Backup</button>
            <button style="background:#f39c12; color:white" onclick="document.getElementById('fileRestore').click()">üìÇ Restore</button>
            <input type="file" id="fileRestore" style="display:none" onchange="importData(this)" accept=".json">
            <button style="background:#7f8c8d; color:white" onclick="logout()">üîí Keluar</button>
        </div>
    </div>

    <div id="summaryStats" class="stats-grid"></div>

    <div class="input-section">
        <div class="input-group" style="grid-column: span 2;">
            <label>NAMA PEKERJA</label>
            <div style="display: flex; gap: 5px;">
                <select id="namaOrang"></select>
                <button onclick="tambahPekerja()" style="background:#3498db; color:white;">+</button>
                <button onclick="hapusPekerja()" style="background:#e74c3c; color:white;">-</button>
            </div>
        </div>
        <div class="input-group"><label>TANGGAL</label><input type="date" id="tgl"></div>
        <div class="input-group"><label>CEGEL (Raw)</label><input type="text" id="cegel" onkeyup="formatInputNoRp(this)"></div>
        <div class="input-group"><label>RATE</label><input type="text" id="rate" onkeyup="formatInput(this)"></div>
        <div class="input-group"><label>GUARD</label><input type="text" id="guardian" onkeyup="formatInput(this)"></div>
        <div class="input-group"><label>MAKAN</label><input type="text" id="makan" value="Rp 10.000" onkeyup="formatInput(this)"></div>
        <div class="input-group"><label>KASBON (Bayar)</label><input type="text" id="kasbon" onkeyup="formatInput(this)"></div>
        <button style="background:#27ae60; color:white;" onclick="simpanData()">SIMPAN</button>
    </div>

    <div class="filter-container">
        <div class="filter-group"><label>CARI NAMA</label><input type="text" id="filterName" placeholder="Ketik nama..." onkeyup="muatSemua()"></div>
        <div class="filter-group">
            <label>PILIH BULAN</label>
            <select id="filterMonth" onchange="muatSemua()">
                <option value="">-- Semua Bulan --</option>
                <option value="01">Januari</option><option value="02">Februari</option><option value="03">Maret</option>
                <option value="04">April</option><option value="05">Mei</option><option value="06">Juni</option>
                <option value="07">Juli</option><option value="08">Agustus</option><option value="09">September</option>
                <option value="10">Oktober</option><option value="11">November</option><option value="12">Desember</option>
            </select>
        </div>
        <div class="filter-group"><label>DARI TANGGAL</label><input type="date" id="filterStart" onchange="muatSemua()"></div>
        <div class="filter-group"><label>SAMPAI TANGGAL</label><input type="date" id="filterEnd" onchange="muatSemua()"></div>
        <button style="background:#7f8c8d; color:white; margin-left:auto" onclick="resetFilter()">RESET</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th rowspan="2" style="width:130px">NAMA</th><th rowspan="2" style="width:110px">TANGGAL</th><th colspan="4" class="bg-earning">PERFORMA PEKERJA</th><th colspan="2" style="background:#2c3e50; color:white">BAGI HASIL</th><th rowspan="2" style="background:#ffff00; color:#000; width:110px">GUARD</th><th rowspan="2" style="width:110px">MAKAN</th><th rowspan="2" style="background:#ff0000; color:#fff; width:110px">KASBON</th><th rowspan="2" style="width:50px">X</th>
                </tr>
                <tr>
                    <th class="bg-earning">CEGEL</th><th class="bg-earning">M</th><th class="bg-earning">RATE</th><th class="bg-earning">TOTAL</th><th style="background:#d35400; color:white">TRANSFER</th><th style="background:#2980b9; color:white">TOMY</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<div id="modalTargetReport" class="modal">
    <div class="modal-content" style="max-width: 1000px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="color:#2ecc71; margin:0;">üóìÔ∏è TOTAL SETORAN VS TARGET (Rp 271.000/Hari)</h2>
            <button onclick="document.getElementById('modalTargetReport').style.display='none'" style="background:#333; color:white;">‚úï</button>
        </div>
        <div class="filter-container" style="background: #2c3e50; margin-bottom: 15px; border-bottom: none; border-radius: 12px;">
            <div class="filter-group">
                <label style="color:white">PILIH BULAN</label>
                <select id="targetMonth" onchange="generateTargetReport()">
                    <option value="01">Januari</option><option value="02">Februari</option><option value="03">Maret</option>
                    <option value="04">April</option><option value="05">Mei</option><option value="06">Juni</option>
                    <option value="07">Juli</option><option value="08">Agustus</option><option value="09">September</option>
                    <option value="10">Oktober</option><option value="11">November</option><option value="12">Desember</option>
                </select>
            </div>
        </div>
        <div id="targetCalendarOutput"></div>
    </div>
</div>

<div id="modalPersonalStats" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="color:#1abc9c; margin:0;">üìä REPORT ABSENSI & WEEKLY ACHIEVEMENT</h2>
            <button onclick="document.getElementById('modalPersonalStats').style.display='none'" style="background:#333; color:white;">‚úï</button>
        </div>
        
        <div class="filter-container" style="margin-bottom:15px; border-radius: 12px; border-bottom: none; background: #2c3e50; display: flex; align-items: center; gap: 20px;">
            <div class="filter-group">
                <label style="color:white">PILIH BULAN</label>
                <select id="statMonth" onchange="generateMonthlyReport()">
                    <option value="01">Januari</option><option value="02">Februari</option><option value="03">Maret</option>
                    <option value="04">April</option><option value="05">Mei</option><option value="06">Juni</option>
                    <option value="07">Juli</option><option value="08">Agustus</option><option value="09">September</option>
                    <option value="10">Oktober</option><option value="11">November</option><option value="12">Desember</option>
                </select>
            </div>

            <div class="filter-group">
                <label style="color:#f1c40f; font-weight: bold;">SET SIKLUS (TGL MULAI)</label>
                <div style="display: flex; gap: 5px; align-items: center;">
                    <input type="number" id="startDayConfig" min="1" max="31" disabled 
                        style="width: 60px; text-align: center; border: 2px solid #f1c40f; color: white; background: rgba(0,0,0,0.3);">
                    <button id="btnEditStartDay" onclick="toggleEditStartDay()" style="background:#f1c40f; color:#000; padding: 5px 10px; font-size: 0.8em;">EDIT</button>
                </div>
            </div>

            <div style="margin-left: auto; display: flex; gap: 15px; align-items: center;">
                <div style="display:flex; align-items:center; gap:5px; color:white; font-size:0.8em;"><div style="width:15px; height:15px; background:#3498db; border-radius:3px;"></div> ‚â•100M</div>
                <div style="display:flex; align-items:center; gap:5px; color:white; font-size:0.8em;"><div style="width:15px; height:15px; background:#f1c40f; border-radius:3px;"></div> ‚â•70M</div>
                <div style="display:flex; align-items:center; gap:5px; color:white; font-size:0.8em;"><div style="width:15px; height:15px; background:#e74c3c; border-radius:3px;"></div> <70M</div>
            </div>
        </div>

        <div id="monthlyReportOutput" class="table-container"></div>
    </div>
</div>

<div id="modalCost" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="color:#e67e22; margin:0;">üí∏ PENGELUARAN (COST & BON OPS)</h2>
            <button onclick="document.getElementById('modalCost').style.display='none'" style="background:#333; color:white;">‚úï</button>
        </div>
        <div class="input-section" style="border-top: 6px solid #e67e22;">
            <div class="input-group"><label>TGL</label><input type="date" id="c_tgl"></div>
            <div class="input-group" style="grid-column: span 2;"><label>JENIS BARANG/KEBUTUHAN</label><input type="text" id="c_jenis"></div>
            <div class="input-group"><label>QTY</label><input type="number" id="c_qty" placeholder="0"></div>
            <div class="input-group"><label>SATUAN</label><input type="text" id="c_satuan" placeholder="Pcs/Bks/dll"></div>
            <div class="input-group"><label>HARGA</label><input type="text" id="c_harga" onkeyup="formatInput(this)"></div>
            <div class="input-group" style="grid-column: span 2;"><label>KETERANGAN</label><input type="text" id="c_ket" placeholder="Tambahkan catatan..."></div>
            <button style="background:#e67e22; color:white;" onclick="simpanCost()">SIMPAN</button>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr style="background:#2c3e50; color:#fff">
                        <th>TANGGAL</th>
                        <th>KEBUTUHAN / BON OPS</th>
                        <th>QTY</th>
                        <th>SATUAN</th>
                        <th>HARGA</th>
                        <th>TOTAL</th>
                        <th>KETERANGAN</th>
                        <th>X</th>
                    </tr>
                </thead>
                <tbody id="costTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="modalKasbon" class="modal"><div class="modal-content"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;"><h2 style="color:#e74c3c; margin:0;">üí∞ MANAJEMEN KASBON</h2><button onclick="document.getElementById('modalKasbon').style.display='none'" style="background:#333; color:white;">‚úï</button></div><div id="vcardOps" class="vcard-scroll" style="margin-bottom:20px"></div><div class="input-section" style="border-top: 6px solid #e74c3c;"><div class="input-group"><label>TGL</label><input type="date" id="k_tgl"></div><div class="input-group"><label>NAMA</label><select id="k_nama"></select></div><div class="input-group"><label>KATEGORI</label><div style="display: flex; gap: 5px;"><select id="k_kategori"></select><button onclick="tambahKategori()" style="background:#3498db; color:white;">+</button><button onclick="hapusKategori()" style="background:#e74c3c; color:white;">-</button></div></div><div class="input-group"><label>JENIS</label><select id="k_jenis"><option value="PINJAM">PINJAM</option><option value="BAYAR">BAYAR</option></select></div><div class="input-group"><label>JUMLAH</label><input type="text" id="k_jumlah" onkeyup="formatInput(this)"></div><div class="input-group" style="grid-column: span 2;"><label>KETERANGAN</label><input type="text" id="k_ket"></div><button style="background:#e74c3c; color:white;" onclick="simpanKasbonManual()">SIMPAN</button></div><div class="table-container"><table><thead><tr style="background:#2c3e50; color:#fff"><th>TGL</th><th>NAMA</th><th>KATEGORI</th><th>JENIS</th><th>JUMLAH</th><th>KET</th><th>X</th></tr></thead><tbody id="kasbonTableBody"></tbody></table></div></div></div>
<div id="accountModal" class="modal"><div class="modal-content"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;"><h2 style="margin:0; color:#9b59b6">üîë Akun Game Sync</h2><div><button onclick="tambahAkunBaru()" style="background:#3498db; color:white;">+ CHAR</button><button onclick="document.getElementById('accountModal').style.display='none'" style="background:#e74c3c; color:white; margin-left:10px;">‚úï</button></div></div><div class="table-container"><table><thead><tr><th>STATUS</th><th>CHAR</th><th>USER ID</th><th>PASS</th><th>PEKERJA</th><th>X</th></tr></thead><tbody id="accountTableBody"></tbody></table></div></div></div>

<div id="notesModal" class="modal">
    <div class="modal-content" style="max-width: 700px; min-height: 80vh; background: #fffceb; color: #333; padding: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom: 2px solid #d4af37; padding-bottom: 10px; margin-bottom: 15px;">
            <h2 style="margin:0; color:#b8860b; font-family: 'Georgia', serif;">üìú FARM NOTES (B5)</h2>
            <button onclick="document.getElementById('notesModal').style.display='none'" style="background:#e74c3c; color:white;">‚úï</button>
        </div>
        <textarea id="notesArea" 
            style="width: 100%; height: 65vh; border: none; background: transparent; 
            line-height: 25px; padding: 0 10px; font-family: 'Courier New', Courier, monospace;
            background-image: linear-gradient(#d1d1d1 1px, transparent 1px);
            background-size: 100% 25px; outline: none; resize: none; font-size: 1.1em; color: #2c3e50;"
            placeholder="Ketik catatan penting di sini..."
            oninput="saveNotes()"></textarea>
        <div style="font-size: 0.8em; color: #888; margin-top: 15px; text-align: right; font-style: italic; border-top: 1px dashed #d4af37; padding-top: 5px;">
            Awan Sync Aktif ‚Ä¢ Penyimpanan Otomatis
        </div>
    </div>
</div>

<div id="modalCash" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="color:#d35400; margin:0;">üíé HISTORI TOP UP CASH</h2>
            <button onclick="document.getElementById('modalCash').style.display='none'" style="background:#333; color:white;">‚úï</button>
        </div>
        <div class="input-section" style="border-top: 6px solid #d35400;">
            <div class="input-group"><label>TANGGAL</label><input type="date" id="cash_tgl"></div>
            <div class="input-group">
                <label>PILIH KARAKTER</label>
                <select id="cash_char"></select>
            </div>
            <div class="input-group"><label>JUMLAH CASH</label><input type="text" id="cash_amount" placeholder="Contoh: 10.000 Cash"></div>
            <div class="input-group"><label>BIAYA (IDR)</label><input type="text" id="cash_price" onkeyup="formatInput(this)"></div>
            <div class="input-group" style="grid-column: span 2;"><label>KETERANGAN</label><input type="text" id="cash_ket" placeholder="Via apa / Untuk apa..."></div>
            <button style="background:#d35400; color:white;" onclick="simpanCash()">SIMPAN TOPUP</button>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr style="background:#2c3e50; color:#fff">
                        <th>TANGGAL</th>
                        <th>KARAKTER</th>
                        <th>JUMLAH CASH</th>
                        <th>BIAYA (IDR)</th>
                        <th>KETERANGAN</th>
                        <th>X</th>
                    </tr>
                </thead>
                <tbody id="cashTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBphHlavM7eC56wLJ1CUcSi4-yc5YwLcl0",
        authDomain: "farmhouse-dd33a.firebaseapp.com",
        databaseURL: "https://farmhouse-dd33a-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "farmhouse-dd33a",
        storageBucket: "farmhouse-dd33a.firebasestorage.app",
        messagingSenderId: "527376522624",
        appId: "1:527376522624:web:465177a2721c104551f565"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let localDB = {};

    db.ref('/').on('value', snap => {
        localDB = snap.val() || {};
        updateSelects(); 
        muatSemua();     
        if(localDB.configApp && localDB.configApp.startDay) {
            document.getElementById('startDayConfig').value = localDB.configApp.startDay;
        }
    });

    function toggleEditStartDay() {
        const input = document.getElementById('startDayConfig');
        const btn = document.getElementById('btnEditStartDay');
        if (input.disabled) {
            input.disabled = false; input.style.background = "#fff"; input.style.color = "#000";
            btn.innerText = "SIMPAN"; btn.style.background = "#27ae60"; btn.style.color = "#fff";
        } else {
            let val = parseInt(input.value);
            if (val < 1 || val > 31 || isNaN(val)) return alert("Tanggal harus 1-31!");
            db.ref('configApp/startDay').set(val).then(() => {
                input.disabled = true; input.style.background = "rgba(0,0,0,0.3)"; input.style.color = "white";
                btn.innerText = "EDIT"; btn.style.background = "#f1c40f"; btn.style.color = "#000";
                generateMonthlyReport();
            });
        }
    }

    function openPersonalStats() {
        const now = new Date();
        document.getElementById('statMonth').value = String(now.getMonth() + 1).padStart(2, '0');
        const savedDay = (localDB.configApp && localDB.configApp.startDay) ? localDB.configApp.startDay : 1;
        document.getElementById('startDayConfig').value = savedDay;
        document.getElementById('modalPersonalStats').style.display = 'block';
        generateMonthlyReport();
    }

    function generateMonthlyReport() {
        const month = document.getElementById('statMonth').value;
        const startDay = parseInt(document.getElementById('startDayConfig').value) || 1;
        const year = new Date().getFullYear();
        const workers = localDB.daftarPekerja ? Object.values(localDB.daftarPekerja).sort() : [];
        const earnings = localDB.earningData || {};
        const startDate = new Date(year, parseInt(month) - 1, startDay);
        let html = `<table style="min-width: 100%;"><thead><tr><th style="width:150px">PEKERJA</th><th>TOTAL CEGEL (SIKLUS)</th><th>HARI AKTIF</th><th>TRACKING ABSENSI & WEEKLY ACHIEVEMENT</th></tr></thead><tbody>`;
        workers.forEach(worker => {
            let totalCegel = 0, daysActive = 0, weeklyData = [0, 0, 0, 0, 0];
            let calendarHtml = `<div class="cal-grid">`;
            for (let i = 0; i < 31; i++) {
                let currentLoopDate = new Date(startDate);
                currentLoopDate.setDate(startDate.getDate() + i);
                const d = currentLoopDate.getDate(), m = String(currentLoopDate.getMonth() + 1).padStart(2, '0'), y = currentLoopDate.getFullYear();
                const dateStr = `${y}-${m}-${String(d).padStart(2, '0')}`;
                const dayData = Object.values(earnings).find(e => e.namaOrang === worker && e.tgl === dateStr);
                let indexMinggu = Math.min(Math.floor(i / 7), 4);
                if (dayData) {
                    totalCegel += (dayData.cegel || 0); daysActive++; weeklyData[indexMinggu] += (dayData.cegel || 0);
                    calendarHtml += `<div class="cal-day day-active" title="${dateStr}">${d}</div>`;
                } else {
                    calendarHtml += `<div class="cal-day day-missing" title="${dateStr}">${d}</div>`;
                }
            }
            calendarHtml += `</div>`;
            let weeklyHtml = `<div style="display:flex; gap:10px; margin-top:12px;">`;
            weeklyData.forEach((valRaw, idx) => {
                let labelTgl = new Date(startDate); labelTgl.setDate(startDate.getDate() + (idx * 7));
                let tglDisplay = labelTgl.getDate() + "/" + (labelTgl.getMonth() + 1);
                let valM = (valRaw / 1000000).toFixed(1);
                let barColor = valRaw >= 100000000 ? "#3498db" : (valRaw >= 70000000 ? "#f1c40f" : "#e74c3c");
                weeklyHtml += `<div style="flex:1; background: rgba(255,255,255,0.03); padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 8px; color: #888;">Minggu ${idx+1} (${tglDisplay})</div>
                    <div style="font-weight: 900; font-size: 13px; color: ${barColor};">${valM}M</div>
                    <div style="width: 100%; height: 6px; background: #222; border-radius: 3px; margin-top:5px; overflow:hidden;">
                        <div style="width: ${Math.min((valRaw/100000000)*100,100)}%; height: 100%; background: ${barColor};"></div>
                    </div>
                </div>`;
            });
            weeklyHtml += `</div>`;
            html += `<tr><td><b>${worker}</b></td><td style="color:#27ae60"><b>${(totalCegel/1000000).toFixed(1)} M</b></td><td>${daysActive} Hari</td><td style="padding: 10px; background: rgba(0,0,0,0.1);">${calendarHtml} ${weeklyHtml}</td></tr>`;
        });
        document.getElementById('monthlyReportOutput').innerHTML = html + `</tbody></table>`;
    }

    // Fungsi Target Report (Kalender) Baru
    function openTargetReport() {
        const now = new Date();
        document.getElementById('targetMonth').value = String(now.getMonth() + 1).padStart(2, '0');
        document.getElementById('modalTargetReport').style.display = 'block';
        generateTargetReport();
    }

    function generateTargetReport() {
        const month = document.getElementById('targetMonth').value;
        const year = new Date().getFullYear();
        const targetHarian = 271000;
        const earnings = localDB.earningData || {};
        const firstDay = new Date(year, parseInt(month) - 1, 1).getDay();
        const daysInMonth = new Date(year, parseInt(month), 0).getDate();
        let html = `<div class="cal-target-grid">`;
        ['MINGGU', 'SENIN', 'SELASA', 'RABU', 'KAMIS', 'JUMAT', 'SABTU'].forEach(d => html += `<div class="day-header">${d}</div>`);
        for (let i = 0; i < firstDay; i++) { html += `<div class="cal-target-day" style="opacity:0; border:none;"></div>`; }
        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${year}-${month}-${String(day).padStart(2, '0')}`;
            let totalTomyHariIni = 0, dataExist = false;
            Object.values(earnings).forEach(d => {
                if (d.tgl === dateStr) {
                    dataExist = true;
                    let kotor = ((d.cegel || 0) / 1000000) * (d.rate || 0);
                    let hTom = ((kotor - (d.guardian || 0)) / 2) - (d.makan || 0);
                    totalTomyHariIni += hTom;
                }
            });
            let selisih = totalTomyHariIni - targetHarian;
            html += `<div class="cal-target-day">
                <span class="cal-target-date">${day}</span>
                <div class="total-info">
                    ${dataExist ? `
                        <small>Total Tomy:</small><br>
                        <b>${fmtRp(totalTomyHariIni)}</b><br>
                        ${selisih < 0 
                            ? `<span class="status-minus">Kurang: ${fmtRp(Math.abs(selisih))}</span>` 
                            : `<span class="status-lunas">‚úì TARGET OK</span>`}
                    ` : `<i style="color:#999; font-size:0.7em;">No Data</i>`}
                </div>
            </div>`;
        }
        html += `</div>`;
        document.getElementById('targetCalendarOutput').innerHTML = html;
    }

    function updateSelects() {
        const pks = localDB.daftarPekerja ? Object.values(localDB.daftarPekerja).sort() : [];
        ['namaOrang', 'k_nama'].forEach(id => {
            const el = document.getElementById(id); if(!el) return;
            const cur = el.value; el.innerHTML = '<option value="">-- Pilih --</option>';
            pks.forEach(p => el.innerHTML += `<option value="${p}">${p}</option>`);
            el.value = cur;
        });

        const cashSel = document.getElementById('cash_char');
        if(cashSel) {
            const curC = cashSel.value; cashSel.innerHTML = '<option value="">-- Pilih Karakter --</option>';
            const akun = localDB.dataAkun || {};
            Object.values(akun).forEach(a => {
                if(a.char) cashSel.innerHTML += `<option value="${a.char}">${a.char}</option>`;
            });
            cashSel.value = curC;
        }

        const kats = localDB.daftarKategori ? Object.values(localDB.daftarKategori).sort() : ["PRIBADI", "OPERASIONAL"];
        const kSel = document.getElementById('k_kategori');
        if(kSel){
            const curK = kSel.value; kSel.innerHTML = '<option value="">-- Pilih --</option>';
            kats.forEach(v => kSel.innerHTML += `<option value="${v}">${v}</option>`);
            kSel.value = curK;
        }
    }

    function muatSemua() {
        const fS = document.getElementById('filterStart').value, fE = document.getElementById('filterEnd').value, fN = document.getElementById('filterName').value.toLowerCase(), fM = document.getElementById('filterMonth').value;
        const body = document.getElementById('tableBody'); body.innerHTML = '';
        const cBody = document.getElementById('costTableBody'); cBody.innerHTML = '';
        const kBody = document.getElementById('kasbonTableBody'); kBody.innerHTML = '';
        const vOps = document.getElementById('vcardOps'); vOps.innerHTML = '';
        const cashBody = document.getElementById('cashTableBody'); if(cashBody) cashBody.innerHTML = '';
        const pks = localDB.daftarPekerja ? Object.values(localDB.daftarPekerja).sort() : [];
        const kats = localDB.daftarKategori ? Object.values(localDB.daftarKategori).sort() : ["PRIBADI", "OPERASIONAL"];
        
        let tkot = 0, ttra = 0, ttomCurrent = 0, tkasE = 0, tkasO_Total = 0, tCostCurrent = 0, count = 0;

        const dEarn = localDB.earningData || {};
        Object.keys(dEarn).sort((a,b) => new Date(dEarn[b].tgl) - new Date(dEarn[a].tgl)).forEach(k => {
            const i = dEarn[k];
            if((fM && i.tgl.split('-')[1] !== fM) || (fS && i.tgl < fS) || (fE && i.tgl > fE) || (fN && !i.namaOrang.toLowerCase().includes(fN))) return;
            let kot = ((i.cegel||0)/1000000) * (i.rate||0), hTra = (((kot - (i.guardian||0)) / 2) + (i.makan || 0)) - (i.kasbon || 0), hTom = ((kot - (i.guardian||0)) / 2) - (i.makan || 0);
            count++; tkot += kot; ttra += hTra; ttomCurrent += hTom; tkasE += (i.kasbon || 0);
            body.innerHTML += `<tr><td class="td-edit"><select onchange="upEarn('${k}','namaOrang',this.value)">${pks.map(p=>`<option value="${p}" ${p===i.namaOrang?'selected':''}>${p}</option>`).join('')}</select></td><td class="td-edit"><input type="date" value="${i.tgl}" onchange="upEarn('${k}','tgl',this.value)"></td><td class="td-edit"><input type="text" value="${(i.cegel||0).toLocaleString('id-ID')}" onchange="upEarnNum('${k}','cegel',this.value)"></td><td>${((i.cegel||0)/1000000).toFixed(1)}M</td><td class="td-edit"><input type="text" value="${fmtRp(i.rate)}" onchange="upEarnNum('${k}','rate',this.value)" onkeyup="formatInput(this)"></td><td>${fmtRp(kot)}</td><td class="txt-transfer">${fmtRp(hTra)}</td><td class="txt-tomy">${fmtRp(hTom)}</td><td class="td-edit"><input type="text" value="${fmtRp(i.guardian)}" onchange="upEarnNum('${k}','guardian',this.value)" onkeyup="formatInput(this)"></td><td class="td-edit"><input type="text" value="${fmtRp(i.makan)}" onchange="upEarnNum('${k}','makan',this.value)" onkeyup="formatInput(this)"></td><td class="td-edit"><input type="text" value="${fmtRp(i.kasbon)}" onchange="upEarnNum('${k}','kasbon',this.value)" onkeyup="formatInput(this)"></td><td><button onclick="hapusDashboard('${k}')">‚úï</button></td></tr>`;
        });

        const dKas = localDB.dbKasbon || {}; let rekKas = {};
        Object.keys(dKas).reverse().forEach(k => {
            const i = dKas[k], amt = i.jumlah || 0;
            if(!rekKas[i.nama]) rekKas[i.nama] = 0; rekKas[i.nama] += (i.jenis === 'PINJAM' ? amt : -amt);
            if ((i.kategori || '').toLowerCase().includes('operasional')) tkasO_Total += (i.jenis === 'PINJAM' ? amt : -amt);
            kBody.innerHTML += `<tr style="color:${i.jenis==='PINJAM'?'#ff4d4d':'#2ecc71'}"><td class="td-edit"><input type="date" value="${i.tgl}" onchange="upKas('${k}','tgl',this.value)"></td><td class="td-edit"><select onchange="upKas('${k}','nama',this.value)">${pks.map(p=>`<option value="${p}" ${p===i.nama?'selected':''}>${p}</option>`).join('')}</select></td><td class="td-edit"><select onchange="upKas('${k}','kategori',this.value)">${kats.map(kat=>`<option value="${kat}" ${kat===i.kategori?'selected':''}>${kat}</option>`).join('')}</select></td><td>${i.jenis}</td><td class="td-edit"><input type="text" value="${fmtRp(amt)}" onchange="upKasNum('${k}','jumlah',this.value)" onkeyup="formatInput(this)"></td><td class="td-edit"><input type="text" value="${i.ket||''}" onchange="upKas('${k}','ket',this.value)"></td><td><button onclick="hapus('dbKasbon/${k}')">‚úï</button></td></tr>`;
        });
        Object.keys(rekKas).forEach(n => { if(rekKas[n] !== 0) vOps.innerHTML += `<div class="vcard-user"><b>üë§ ${n}</b><br><span class="amt">${fmtRp(rekKas[n])}</span></div>`; });

        const dCost = localDB.dbCost || {};
        Object.keys(dCost).forEach(k => { 
            const i = dCost[k], tot = (i.qty||0)*(i.harga||0); tCostCurrent += tot; 
            cBody.innerHTML += `<tr>
                <td class="td-edit"><input type="date" value="${i.tgl||''}" onchange="db.ref('dbCost/${k}/tgl').set(this.value)"></td>
                <td class="td-edit"><input type="text" value="${i.jenis||''}" onchange="db.ref('dbCost/${k}/jenis').set(this.value)" style="text-align:left; padding-left:15px"></td>
                <td class="td-edit"><input type="number" value="${i.qty||0}" onchange="db.ref('dbCost/${k}/qty').set(parseFloat(this.value)||0)"></td>
                <td class="td-edit"><input type="text" value="${i.satuan||''}" onchange="db.ref('dbCost/${k}/satuan').set(this.value)"></td>
                <td class="td-edit"><input type="text" value="${fmtRp(i.harga)}" onchange="db.ref('dbCost/${k}/harga').set(parseRaw(this.value))" onkeyup="formatInput(this)"></td>
                <td style="font-weight:bold">${fmtRp(tot)}</td>
                <td class="td-edit"><input type="text" value="${i.keterangan||''}" onchange="db.ref('dbCost/${k}/keterangan').set(this.value)"></td>
                <td><button onclick="hapus('dbCost/${k}')">‚úï</button></td>
            </tr>`; 
        });

        const dCash = localDB.dbCashTopup || {};
        Object.keys(dCash).reverse().forEach(k => {
            const i = dCash[k];
            cashBody.innerHTML += `<tr>
                <td class="td-edit"><input type="date" value="${i.tgl}" onchange="db.ref('dbCashTopup/${k}/tgl').set(this.value)"></td>
                <td><b>${i.char}</b></td>
                <td class="td-edit"><input type="text" value="${i.amount}" onchange="db.ref('dbCashTopup/${k}/amount').set(this.value)"></td>
                <td class="td-edit"><input type="text" value="${fmtRp(i.price)}" onchange="db.ref('dbCashTopup/${k}/price').set(parseRaw(this.value))" onkeyup="formatInput(this)"></td>
                <td class="td-edit"><input type="text" value="${i.ket}" onchange="db.ref('dbCashTopup/${k}/ket').set(this.value)"></td>
                <td><button onclick="hapus('dbCashTopup/${k}')">‚úï</button></td>
            </tr>`;
        });

        document.getElementById('summaryStats').innerHTML = `<div class="stat-card" style="background:#27ae60"><span class="label">Pemasukan Kotor</span><span class="value">${fmtRp(tkot)}</span></div><div class="stat-card" style="background:#e67e22"><span class="label">Total Transfer</span><span class="value">${fmtRp(ttra)}</span></div><div class="stat-card" style="background:#e74c3c"><span class="label">Bon Operasional</span><span class="value">${fmtRp(tkasO_Total)}</span></div><div class="stat-card" style="background:#d35400"><span class="label">Cost Barang</span><span class="value">${fmtRp(tCostCurrent)}</span></div><div class="stat-card" style="background:#2980b9; grid-column: span 2;"><span class="label">Profit Kotor (Tomy)</span><span class="value">${fmtRp(ttomCurrent)}</span></div><div class="stat-card" style="background:#c0392b; grid-column: span 2;"><span class="label">Total Bon Pekerja</span><span class="value">${fmtRp(tkasE)}</span></div><div class="stat-card" style="background:#8e44ad; grid-column: span 4; text-align:center;"><span class="label">PROFIT BERSIH (NET)</span><span class="value" style="font-size:2.5em;">${fmtRp(ttomCurrent - tCostCurrent - tkasO_Total)}</span></div>`;
        document.getElementById('syncStatus').innerText = `üìç Terhubung (${count} Data)`;
    }

    function fmtRp(v) { return 'Rp ' + Math.round(v || 0).toLocaleString('id-ID'); }
    function parseRaw(s) { return parseFloat(s.toString().replace(/Rp/g, '').replace(/\./g, '').replace(/\s/g, '').replace(',', '.')) || 0; }
    function formatInput(obj) { let v = obj.value.replace(/[^0-9]/g, ''); obj.value = v ? 'Rp ' + parseInt(v).toLocaleString('id-ID') : ''; }
    function formatInputNoRp(obj) { let v = obj.value.replace(/[^0-9]/g, ''); obj.value = v ? parseInt(v).toLocaleString('id-ID') : ''; }
    
    function simpanData() { 
        const n = document.getElementById('namaOrang').value, t = document.getElementById('tgl').value;
        let valKasbon = parseRaw(document.getElementById('kasbon').value); 
        if(!n || !t) return alert("Lengkapi data Nama dan Tanggal!"); 
        if(valKasbon > 0) {
            let sisaHutang = 0; const dKas = localDB.dbKasbon || {};
            Object.values(dKas).forEach(i => { if(i.nama === n) { sisaHutang += (i.jenis === 'PINJAM' ? (i.jumlah || 0) : -(i.jumlah || 0)); } });
            if(sisaHutang <= 0) { alert(`‚ö†Ô∏è TIDAK ADA KASBON!\n${n} tidak memiliki pinjaman. Nominal kasbon diubah menjadi Rp 0.`); valKasbon = 0; } 
            else if (valKasbon > sisaHutang) { alert(`‚ö†Ô∏è INPUT MELEBIHI HUTANG!\nSisa hutang ${n} adalah ${fmtRp(sisaHutang)}. Nilai simpan disesuaikan.`); valKasbon = sisaHutang; }
        }
        const newRef = db.ref('earningData').push({ namaOrang: n, tgl: t, cegel: parseRaw(document.getElementById('cegel').value), rate: parseRaw(document.getElementById('rate').value), guardian: parseRaw(document.getElementById('guardian').value), makan: parseRaw(document.getElementById('makan').value), kasbon: valKasbon }); 
        if(valKasbon > 0) { db.ref('dbKasbon').push({ tgl: t, nama: n, kategori: "PRIBADI", jenis: "BAYAR", jumlah: valKasbon, parentKey: newRef.key }); alert(`‚úÖ Simpan Berhasil. Kasbon terpotong ${fmtRp(valKasbon)}.`); } else { alert(`‚úÖ Simpan Berhasil.`); }
        ["cegel","rate","guardian","kasbon"].forEach(id => document.getElementById(id).value = ''); 
    }

    function simpanCost() { 
        const t = document.getElementById('c_tgl').value, j = document.getElementById('c_jenis').value, k = document.getElementById('c_ket').value;
        if(!t || !j) return alert("Tgl & Jenis Barang harus diisi!");
        db.ref('dbCost').push({ tgl: t, jenis: j, qty: parseFloat(document.getElementById('c_qty').value)||0, satuan: document.getElementById('c_satuan').value, harga: parseRaw(document.getElementById('c_harga').value), keterangan: k }).then(() => { ["c_jenis","c_qty","c_satuan","c_harga","c_ket"].forEach(id => document.getElementById(id).value = ''); });
    }

    function simpanCash() {
        const t = document.getElementById('cash_tgl').value, c = document.getElementById('cash_char').value, a = document.getElementById('cash_amount').value, p = parseRaw(document.getElementById('cash_price').value);
        if(!t || !c || !a) return alert("Lengkapi data Top Up!");
        db.ref('dbCashTopup').push({ tgl: t, char: c, amount: a, price: p, ket: document.getElementById('cash_ket').value }).then(() => { ["cash_char", "cash_amount", "cash_price", "cash_ket"].forEach(id => document.getElementById(id).value = ''); alert("Berhasil mencatat Top Up."); });
    }

    function simpanKasbonManual() { db.ref('dbKasbon').push({ tgl: document.getElementById('k_tgl').value, nama: document.getElementById('k_nama').value, kategori: document.getElementById('k_kategori').value, jenis: document.getElementById('k_jenis').value, jumlah: parseRaw(document.getElementById('k_jumlah').value), ket: document.getElementById('k_ket').value }); }
    function upEarn(k,f,v) { db.ref(`earningData/${k}/${f}`).set(v); }
    function upEarnNum(k,f,v) { db.ref(`earningData/${k}/${f}`).set(parseRaw(v)); }
    function upKas(k,f,v) { db.ref(`dbKasbon/${k}/${f}`).set(v); }
    function upKasNum(k,f,v) { db.ref(`dbKasbon/${k}/${f}`).set(parseRaw(v)); }
    function hapus(p) { if(confirm("Hapus?")) db.ref(p).remove(); }
    
    function hapusDashboard(k) { 
        if(confirm("Hapus data dashboard ini?")) {
            const dataTarget = localDB.earningData[k];
            if (dataTarget && dataTarget.kasbon > 0) { const dKas = localDB.dbKasbon || {}; Object.keys(dKas).forEach(keyKas => { if (dKas[keyKas].parentKey === k) { db.ref(`dbKasbon/${keyKas}`).remove(); } }); }
            db.ref(`earningData/${k}`).remove();
        } 
    }

    function openNotesWithPassword() { if(prompt("Pass Notes:") === "tomy1234") { document.getElementById('notesModal').style.display = 'block'; loadNotes(); } }
    function saveNotes() { const text = document.getElementById('notesArea').value; db.ref('appNotes').set(text); }
    function loadNotes() { db.ref('appNotes').once('value', (snap) => { if(snap.exists()) { document.getElementById('notesArea').value = snap.val(); } }); }
    function resetFilter() { document.querySelectorAll('.filter-container input, .filter-container select').forEach(i => i.value = ''); muatSemua(); }
    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
    function logout() { localStorage.removeItem("isLoggedIn"); location.reload(); }
    function checkPin() { if(document.getElementById('pinInput').value === "1234") { localStorage.setItem("isLoggedIn", "true"); document.getElementById('loginOverlay').style.display = 'none'; } }
    function bukaKasbonPrompt() { if(prompt("Pass Kasbon:") === "tomy1234") document.getElementById('modalKasbon').style.display='block'; }
    function openAccountWithPassword() { if(prompt("Pass Akun:") === "54321") document.getElementById('accountModal').style.display='block'; muatDataAkun(); }
    function openCashModal() { if(prompt("Pass TopUp:") === "tomy1234") document.getElementById('modalCash').style.display='block'; }
    
    function muatDataAkun() { 
        const tbody = document.getElementById('accountTableBody'); tbody.innerHTML = ''; 
        const akun = localDB.dataAkun || {}, pks = localDB.daftarPekerja ? Object.values(localDB.daftarPekerja).sort() : []; 
        Object.keys(akun).forEach(k => { 
            const d = akun[k], isUsed = d.pekerja && d.pekerja !== ""; 
            tbody.innerHTML += `<tr><td><span class="status-dot ${isUsed ? 'dot-green' : 'dot-red'}"></span> <b>${isUsed ? 'TERPAKAI' : 'TERSEDIA'}</b></td><td class="td-edit"><input type="text" value="${d.char || ''}" onchange="db.ref('dataAkun/${k}/char').set(this.value)"></td><td class="td-edit"><input type="text" value="${d.user || ''}" onchange="db.ref('dataAkun/${k}/user').set(this.value)"></td><td class="td-edit"><input type="text" value="${d.pass || ''}" onchange="db.ref('dataAkun/${k}/pass').set(this.value)"></td><td class="td-edit"><select onchange="db.ref('dataAkun/${k}/pekerja').set(this.value || '')"><option value=\"\">-- Kosong --</option>${pks.map(p => `<option value="${p}" ${p === d.pekerja ? 'selected' : ''}>${p}</option>`).join('')}</select></td><td><button onclick=\"hapus('dataAkun/${k}')\">‚úï</button></td></tr>`; 
        }); 
    }
    function tambahAkunBaru() { db.ref('dataAkun').push({ char: 'Baru', user: '', pass: '', pekerja: '' }); }
    function tambahPekerja() { const n = prompt("Nama:"); if(n) db.ref('daftarPekerja').push(n); }
    function hapusPekerja() { const v = document.getElementById('namaOrang').value; if(v && confirm(`Hapus ${v}?`)) db.ref('daftarPekerja').once('value', s => { s.forEach(c => { if(c.val() === v) c.ref.remove(); }); }); }
    function exportData() { db.ref('/').once('value').then(snap => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(snap.val(),null,2)],{type:'application/json'})); a.download='Backup_Farmhouse.json'; a.click(); }); }
    function importData(input) { const f = input.files[0]; if(!f) return; const r = new FileReader(); r.onload = (e) => { if(confirm("Restore?")) db.ref('/').set(JSON.parse(e.target.result)); }; r.readAsText(f); }
    window.onload = () => { if(localStorage.getItem("isLoggedIn") === "true") document.getElementById('loginOverlay').style.display = 'none'; const t = new Date().toISOString().split('T')[0]; document.getElementById('tgl').value = t; document.getElementById('k_tgl').value = t; document.getElementById('c_tgl').value = t; document.getElementById('cash_tgl').value = t; };
</script>
</body>
</html>
